<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المطبخ</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ✅ Bell audio -->
<audio id="orderBell" src="bell.mp3" preload="auto"></audio>

<div class="container">
<h1>طلبات المطبخ</h1>
<div id="ordersContainer" class="d-flex flex-wrap justify-content-center"></div>
</div>

<div class="nav-bar">
<button onclick="goCashier()">الكاشير</button>
<button onclick="goOrders()">جميع الطلبات</button>
<button onclick="goDashboard()">لوحة المبيعات</button>
</div>

<script>
// keep track of previous pending orders
let lastOrderCount = 0;

function loadOrders() {
  const container = document.getElementById('ordersContainer');
  container.innerHTML = '';
  let pending = JSON.parse(localStorage.getItem('pendingOrders') || '[]');

  // ✅ Play bell if new order came
  if(pending.length > lastOrderCount){
    document.getElementById('orderBell').play();
  }
  lastOrderCount = pending.length;

  pending.forEach(order => {
    const div = document.createElement('div');
    div.className = 'order-box';
    let itemsStr = order.items.map(i => `${i.item} × ${i.qty}`).join("<br>");
    div.innerHTML = `<h3>طلب #${order.id}</h3>
                     <p>${itemsStr}</p>
                     <p><strong>المجموع: ${order.total} ليرة</strong></p>
                     <button class="btn btn-danger btn-sm mt-2" onclick="finishPrep(${order.id})">تم التحضير</button>`;
    container.appendChild(div);
  });

  if(pending.length===0){ 
    container.innerHTML="<h2>لا توجد طلبات حالياً ✅</h2>"; 
  }
}

function finishPrep(orderId) {
  let pending = JSON.parse(localStorage.getItem('pendingOrders') || '[]');
  pending = pending.filter(o => o.id!==orderId);
  localStorage.setItem('pendingOrders', JSON.stringify(pending));
  loadOrders();
}

// refresh orders every 5 seconds
setInterval(loadOrders,5000);
loadOrders();

function goCashier(){ window.location.href='index.html'; }
function goOrders(){ window.location.href='Orders.html'; }
function goDashboard(){ window.location.href='Dashboard.html'; }
</script>
</body>
</html>
