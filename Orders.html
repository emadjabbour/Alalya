<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>جميع الطلبات</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
  table th, table td { text-align: center; }
  .nav-buttons button { margin: 5px; }
</style>
</head>
<body>
  <h1>جميع الطلبات</h1>

  <div class="mb-3">
    <label for="salesDate" class="form-label">اختر اليوم:</label>
    <input type="date" id="salesDate" class="form-control d-inline-block w-auto" onchange="loadOrders()">
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>رقم الطلب</th>
        <th>الوقت</th>
        <th>المحتويات</th>
        <th>المجموع</th>
        <th>حذف</th>
      </tr>
    </thead>
    <tbody id="ordersTable"></tbody>
  </table>

  <!-- شريط التنقل -->
  <div class="nav-buttons d-flex justify-content-center mt-4 flex-wrap">
    <button class="btn btn-primary" onclick="viewDashboard()">لوحة المبيعات اليومية</button>
    <button class="btn btn-info" onclick="viewKitchen()">المطبخ</button>
    <button class="btn btn-warning" onclick="viewStock()">إدارة الأصناف</button>
    <button class="btn btn-success" onclick="goBack()">الكاشير</button>
  </div>

<script>
function loadOrders() {
  const table = document.getElementById('ordersTable');
  table.innerHTML = '';

  const selectedDate = document.getElementById('salesDate').value || new Date().toISOString().split('T')[0];
  let sales = JSON.parse(localStorage.getItem('sales_' + selectedDate) || '[]');

  if(sales.length === 0) {
    table.innerHTML = `<tr><td colspan="5">لا توجد طلبات لهذا اليوم ✅</td></tr>`;
    return;
  }

  sales.forEach(order => {
    let itemsStr = order.items.map(i => `${i.item} × ${i.qty}`).join("<br>");
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${order.id}</td>
      <td>${order.time}</td>
      <td>${itemsStr}</td>
      <td>${order.total} ليرة</td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteOrder(${order.id})">حذف</button></td>
    `;
    table.appendChild(tr);
  });
}

function deleteOrder(orderId) {
  if (!confirm('هل أنت متأكد من حذف هذا الطلب؟')) return;

  const selectedDate = document.getElementById('salesDate').value || new Date().toISOString().split('T')[0];
  let sales = JSON.parse(localStorage.getItem('sales_' + selectedDate) || '[]');
  sales = sales.filter(order => order.id !== orderId);
  localStorage.setItem('sales_' + selectedDate, JSON.stringify(sales));

  // إزالة من الطلبات المعلقة في المطبخ إن وجدت
  let pending = JSON.parse(localStorage.getItem('pendingOrders') || '[]');
  pending = pending.filter(order => order.id !== orderId);
  localStorage.setItem('pendingOrders', JSON.stringify(pending));

  loadOrders();
}

function viewDashboard() { window.location.href = 'Dashboard.html'; }
function viewKitchen() { window.location.href = 'Kitchen.html'; }
function viewStock() { window.location.href = 'Stock.html'; }
function goBack() { window.location.href = 'index.html'; }

window.onload = () => {
  // تحديد التاريخ الحالي افتراضيًا
  document.getElementById('salesDate').value = new Date().toISOString().split('T')[0];
  loadOrders();
};
</script>
</body>
</html>
