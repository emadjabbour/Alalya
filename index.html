<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قائمة الكاشير</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>اختر السندويش</h1>
  <div class="text-center mb-3" id="sandwichButtons"></div>

  <h2>طلبك الحالي:</h2>
  <ul id="orderList"></ul>
  <h3 id="orderTotal">المجموع: 0 ليرة</h3>

  <button id="finishBtn" class="btn btn-success btn-lg d-block mx-auto my-4"
          style="font-size: 28px; padding: 25px 60px; border-radius: 15px;"
          onclick="finishOrder()">
    تم الدفع نقداً
  </button>

  <div class="nav-buttons d-flex justify-content-center mt-4 mb-4 flex-wrap">
    <button class="btn btn-primary m-1" onclick="viewDashboard()">لوحة المبيعات اليومية</button>
    <button class="btn btn-secondary m-1" onclick="viewOrders()">صفحة الطلبات</button>
    <button class="btn btn-info m-1" onclick="viewKitchen()">المطبخ</button>
    <button class="btn btn-warning m-1" onclick="viewStock()">إدارة الأصناف</button>
  </div>
</div>

<script>
const SCRIPT_URL = "AKfycbwSj4koN2ISIf2RDBLLnoT3BHrA-A0owF_wwDoA_mAqIVD97CziIopzzkWaxwgmWFvo"; // replace with your deployed Apps Script URL
let prices = JSON.parse(localStorage.getItem('prices')) || {
  'نقانق': 10000,
  'نقانق سمون': 15000,
  'بطاطا': 8000,
  'شيش': 12000,
  'شيش سمون': 18000
};
let orders = [];

function renderSandwichButtons() {
  const container = document.getElementById('sandwichButtons');
  container.innerHTML = '';
  Object.keys(prices).forEach(item => {
    let btn = document.createElement('button');
    btn.className = 'btn btn-outline-primary btn-lg m-2 px-4 py-3';
    btn.textContent = `${item} - ${prices[item]} ليرة`;
    btn.onclick = () => addOrder(item);
    container.appendChild(btn);
  });
}

function addOrder(item) {
  let existing = orders.find(o => o.item === item);
  if(existing) existing.qty++;
  else orders.push({item: item, qty: 1});
  updateOrderList();
}

function updateOrderList() {
  const list = document.getElementById('orderList');
  list.innerHTML = '';
  let total = 0;
  orders.forEach(order => {
    const li = document.createElement('li');
    li.textContent = `${order.item} × ${order.qty} - ${order.qty * prices[order.item]} ليرة`;
    list.appendChild(li);
    total += order.qty * prices[order.item];
  });
  document.getElementById('orderTotal').textContent = "المجموع: " + total + " ليرة";
}

async function finishOrder() {
  if(orders.length === 0) { alert('لم يتم اختيار أي طلب!'); return; }

  let today = new Date().toISOString().split('T')[0];
  let key = "sales_" + today;
  let sales = JSON.parse(localStorage.getItem(key) || '[]');
  let id = sales.length + 1;
  let total = orders.reduce((sum,o)=>sum + o.qty * prices[o.item], 0);

  let orderData = {id, items: orders, total, time: new Date().toLocaleString()};

  // save locally
  sales.push(orderData);
  localStorage.setItem(key, JSON.stringify(sales));

  // send to Google Sheets
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(orderData)
    });
  } catch(err) {
    console.error("Failed to send order to Google Sheets:", err);
  }

  alert('تم تسجيل الطلب بنجاح!');
  orders = [];
  updateOrderList();
}

function viewDashboard() { window.location.href='Dashboard.html'; }
function viewOrders() { window.location.href='Orders.html'; }
function viewKitchen() { window.location.href='Kitchen.html'; }
function viewStock() { window.location.href='Stock.html'; }

renderSandwichButtons();
</script>
</body>
</html>
